#Angular 2 integration with MVC as a brownfields approach

## Integrating MVC and Components gracefully and elegantly

###Components in your views
 
One thing I find really important is to have good connascence in your HTML, with this approuch you can see clearly when and where components are used
  
In https://github.com/barendb/ng2-mvc-mixed/blob/master/holy-grail/Views/Home/Index.cshtml you'll notice components used directly in the view  
  
```html
<-- [user] is a property of home and a object (in this case a string) is being passed in from the MVC view -->
<home [user]="'@Model.User'"></home>

<partial></partial>
```

This demonstrates how MVC views and Angular 2 components can be mixed together

###Using MVC views as templates in your component

As with many MVVM type frameworks you can define a template for your component, Angular 2 is flexible enough to allow you to define a URL of component template.
In this case I wanted to use a *Razor* view to output some data then consume that in my component. 

The `<partial>` component references a view at `/partials/example`

See the syntax for the component
https://github.com/barendb/ng2-mvc-mixed/blob/master/holy-grail/scripts/app/components/partial/partial.component.ts

This path is just a MVC partial generated by the MVC `PartialController` with a `Example` action.

In the view we mix *Razor* and *Angular 2* syntax together. Why on earth would one like to do that? We'll lets say you have a interactive grid, you can create a service to retreive some `json` data then use a component or several components to render that grid. However in *Razor* is massively powerfull and fast, by sacrificing a few KB by fetching the view you can keep your complex Razor generated code and reduce the complexity of integrating your interactive components.  

```html

<table>
	@foreach (var r in Model.Rows)
	{
		<tr>
			@foreach (var c in r.Columns)
			{
				<td>
					@c.Value
				</td>
			}
		</tr>
	}
</table>

<br/>
<strong>{{message}}</strong>
```

The above example will mix output a matrix of numbers with Razor and then output the `message` property from the component.

See the view syntax here
https://github.com/barendb/ng2-mvc-mixed/blob/master/holy-grail/Views/Partials/_Example.cshtml


##Communication between components

One aspect that's quite difficult to solve is communication between components, using *RX* we can achieve this simply by using *Observers* 

###Services and DI

Angular 2 (and prior version) have the concept of services, which can be injected into your component. *Just like C# DI!* The concepts are exactly the same.

```javascript
export class MissionControlComponent {

	constructor(private missionService: MissionService) {
		
	}
}
```
Here the component will receive a dependency injected service

```javascript
import {MissionService} from "./services/mission.service";

@NgModule({
	...
	providers: [MissionService],
	...
})
```
You have to inform NG2 when bootstrapping that you're making this service availble for DI

### RX Observables 

Not going to go in detail here, these concepts are not unique to NG2 but since NG2 uses RX in it's core it's recommended and available for use.

http://reactivex.io/documentation/observable.html

In short the `MissionService` have a `missionConfirmed` observable, the `MissionControl` component subscribes to this observable to be notified of state changes

```javascript
/// mission service
missionAnnounced$ = this.missionAnnouncedSource.asObservable();
```

```javascript
/// mission control component
missionService.missionConfirmed$.subscribe(
			astronaut => {
				this.history.push(`${astronaut} confirmed the mission`);
			});
```

In the example whenever an astronaut confirms his mission, the history in this component will be updated.

This is just one way of solving the problem, NG2 documentation have several recipes for dealing with communication between components


## Using this demo

This demo uses webpack, so you'll need that at a global level

```
> npm install webpack -g
```

In holy-grail folder

```
> npm install
> npm run typings-install
> npm run build
```

If you're dev'n

```
> npm run watch
```

Open the project in VS and download let it download the Nuget packages and run your project.